<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.myapp.mapper.BoardMapper">

  <insert id="insertBoard">
      INSERT INTO TEST_BOARD(title, content, writer) 
      VALUES(#{title}, #{content}, #{writer})
  </insert>

  <update id="updateBoard">
      UPDATE tbl_board
      SET title = #{title},
          content = #{content},
          writer = #{writer}
      WHERE bno = #{bno}
  </update>

  <!-- 검색 -->
  <sql id="criteria">
      <trim prefix="WHERE (" suffix=")" prefixOverrides="OR">
        <foreach collection="typeArr" item="type">
            <trim prefix="OR">
                <choose>
                    <when test="type=='T'.toString()">
                        title like '%'||#{keyword}||'%'
                    </when>
                    <when test="type=='C'.toString()">
                        content like '%'||#{keyword}||'%'
                    </when>
                    <when test="type=='W'.toString()">
                        writer like '%'||#{keyword}||'%'
                    </when>
                </choose>
            </trim>
        </foreach>
      </trim>
  </sql>

  <!-- 페이징 목록 -->
  <select id="listPage" resultType="org.zerock.myapp.domain.BoardVO">
      SELECT /*+index_desc(tbl_board)*/ * 
      FROM tbl_board
      <if test="keyword != null">
          <include refid="criteria"></include>
      </if>
      OFFSET (#{currPage}-1) * #{amount} ROW 
      FETCH NEXT #{amount} ROWS ONLY
  </select>

  <select id="boardCount" resultType="int">
        SELECT count(*) FROM tbl_board
        <if test="keyword != null">
            <include refid="criteria"></include>
        </if>
  </select>
</mapper>